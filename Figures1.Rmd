---
title: "Figures"
author: "Madison Patch"
date: "2025-06-10"
output: pdf_document
---




sooooo the computer crashed, corrupted the file, and only had a version from a week prior. So none of this is updated, but will be saved just in case

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r McM and DC egg counts, echo=FALSE}
plot(pressure)
```


```{r dry weights histogram, echo=FALSE}

## not needed for main text


unique_dry_weight <- unique(metadata_final$Percent_dry)

library(ggplot2)

ggplot(data = data.frame(Percent_dry = unique_dry_weight), aes(x = 1 - Percent_dry)) +
  geom_histogram(binwidth = 0.05, fill = "blue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of Dry Weights",
       x = "Percentage of Water", y = "Number of Samples") +
  theme_minimal()



```


```{r reads box plot, echo=FALSE}
plot(pressure)
```



```{r EPG by reads and method, echo=FALSE}
library(ggplot2)
library(dplyr)



ggplot(metadata_final, aes(x = Method, y = Reads, fill = Method)) +
  geom_violin(alpha = 0.6) +
  geom_jitter(width = 0.1, alpha = 0.6, color = "black") +
  labs(title = "Violin Plot of Reads Across Methods",
       x = "Method", y = "Number of Reads") +
  theme_minimal()+
  theme(legend.position = "none")



ggplot(metadata_final, aes(x = EPG_DC_dry, y = Reads, color = Method)) +
  geom_point(alpha = 0.7) +  # Scatter plot points
  geom_smooth(method = "lm", se = TRUE) +  # Linear trend lines per Method
  labs(title = "Interaction Effect of Method and EPG on Reads",
       x = "Egg Per Gram (EPG)", y = "Number of Reads") +
  theme_minimal()


ggplot(metadata_final, aes(x = EPG_DC_dry, y = Reads, color = Method, shape = Method)) +
  geom_point(alpha = 0.7, size = 2.5) +
  geom_smooth(method = "lm",  aes(linetype = Method, fill = Method), se = F, alpha = 0.15) +
  labs(title = "Interaction Effect of Method and EPG on Reads",
       x = "Egg Per Gram (EPG)", y = "Number of Reads") +
  theme_classic()



library(broom)

metadata_final %>%
  group_by(Method) %>%
  do(tidy(lm(Reads ~ EPG_DC_dry, data = .)))



```


```{r richness and eveness, echo=FALSE}

df_diversity_long <- pivot_longer(metadata_rarefied, cols = c(Richness_asv, Richness_sp, Richness_g,
                                                    Evenness_asv, Evenness_sp, Evenness_g),
                        names_to = "Diversity Metric", values_to = "Diversity Values")
df_diversity_long <- separate(df_diversity_long, 'Diversity Metric', into = c("Diversity_metric", "Taxonomy_level"), sep = '_')

df_diversity_long$Taxonomy_level <- factor(df_diversity_long$Taxonomy_level, levels = c('asv', 'sp', 'g'), labels = c('ASVs', 'Species', 'Genera'))

## facet grid box plot richness and evenness
ggplot(df_diversity_long, mapping = aes(x= Method, y = `Diversity Values`)) +
  geom_boxplot()+
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = .5, fill = 'red')+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  facet_grid(Diversity_metric ~ Taxonomy_level, scales = 'free_y')+
  theme_bw()


df_evenness <- df_diversity_long[df_diversity_long$Diversity_metric == "Evenness", ]



## facet grid box plot richness and evenness
ggplot(df_evenness, mapping = aes(x= Method, y = `Diversity Values`)) +
  geom_boxplot()+
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = .5, fill = 'red')+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  facet_grid(Diversity_metric ~ Taxonomy_level, scales = 'free_y')+
  theme_bw()




ggplot(metadata_rarefied, aes(x = EPG_DC_dry, y = Richness_asv, color = Sample_type)) +
  geom_point(alpha = 0.7) +  # Adds individual data points
  geom_smooth(method = "lm", se = TRUE) +  # Adds trend lines for each Method
  labs(title = "Relationship Between EPG and Richness",
       x = "Egg Per Gram (EPG)", y = "ASV Richness") +
  theme_minimal()

ggplot(metadata_rarefied, aes(x = EPG_DC_dry, y = Richness_sp, color = Sample_type)) +
  geom_point(alpha = 0.7) +  # Adds individual data points
  geom_smooth(method = "lm", se = TRUE) +  # Adds trend lines for each Method
  labs(title = "Relationship Between EPG and Richness",
       x = "Egg Per Gram (EPG)", y = "Species Richness") +
  theme_minimal()

ggplot(metadata_rarefied, aes(x = EPG_DC_dry, y = Richness_g, color = Sample_type)) +
  geom_point(alpha = 0.7) +  # Adds individual data points
  geom_smooth(method = "lm", se = TRUE) +  # Adds trend lines for each Method
  labs(title = "Relationship Between EPG and Richness",
       x = "Egg Per Gram (EPG)", y = "Genus Richness") +
  theme_minimal()



ggplot(metadata_final, aes(x = EPG_DC_dry, y = Reads, color = Method, shape = Method)) +
  geom_point(alpha = 0.7, size = 2.5) +
  geom_smooth(method = "lm",  aes(linetype = Method, fill = Method), se = F, alpha = 0.15) +
  labs(title = "Interaction Effect of Method and EPG on Reads",
       x = "Egg Per Gram (EPG)", y = "Number of Reads") +
  theme_classic()








library(tidyr)
library(dplyr)

richness_long <- metadata_rarefied %>%
  dplyr::select(EPG_DC_dry, Sample_type, Richness_asv, Richness_sp, Richness_g) %>%
  pivot_longer(cols = starts_with("Richness"),
               names_to = "Richness_Type",
               values_to = "Richness_Value") %>%
  mutate(Richness_Type = recode(Richness_Type,
                                Richness_asv = "ASV Richness",
                                Richness_sp = "Species Richness",
                                Richness_g = "Genus Richness"))


ggplot(richness_long, aes(x = EPG_DC_dry, y = Richness_Value,
                          color = Sample_type, shape = Sample_type)) +
  geom_point(alpha = 0.7, size = 2.5) +
  geom_smooth(method = "lm", aes(linetype = Sample_type), se = FALSE) +
  facet_wrap(~ Richness_Type, scales = "free_y") +
  labs(title = "Relationship Between EPG and Richness Metrics",
       x = "Egg Per Gram (EPG)", y = "Richness",
       color = "Sample Type", shape = "Sample Type", linetype = "Sample Type") +
  theme_classic()



```


```{r, echo=FALSE}
plot(pressure)
```

```{r heatmap, echo=FALSE}


library(viridisLite)

cividis_colors <- viridisLite::cividis(n = 100)
blue_from_cividis <- cividis_colors[10]


"#00204DFF"
"#002455FF"
"#00275FFF"
"#00306FFF"

library(dplyr)

genus_prevalence <- df_presence_g_long %>%
  group_by(Genus, Method) %>%
  summarise(Prevalence = mean(Detection), .groups = "drop")


genus_order <- genus_prevalence %>%
  group_by(Genus) %>%
  summarise(MeanPrev = mean(Prevalence)) %>%
  arrange(desc(MeanPrev)) %>%
  pull(Genus)


genus_prevalence$Genus <- factor(genus_prevalence$Genus, levels = genus_order)



library(ggplot2)

genus_prev_plot <- ggplot(genus_prevalence, aes(x = Method, y = Genus, fill = Prevalence)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "white", high = blue_from_cividis, limit = c(0,1)) +
  labs(
    title = "Genus Detection Prevalence by Method",
    x = "Method",
    y = "Genus",
    fill = "Prevalence"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.y = element_text(size = 9),
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", hjust = 0.5)
  )



ggsave(plot=genus_prev_plot, height = 169,width=169, dpi=300, units = 'mm', filename = "C:/Users/Weinstein Lab/Desktop/URCO-Horse-Project/genus_prev_plot.pdf", useDingbats=FALSE)



library(dplyr)
library(tidyr)



df_presence_sp_long <- df_presence_sp_long %>%
  separate(Species, into = c("Genus"), sep = "_", remove = FALSE)

species_prevalence <- df_presence_sp_long %>%
  group_by(Genus, Species, Method) %>%
  summarise(Prevalence = mean(Detection), .groups = "drop")



species_order <- species_prevalence %>%
  group_by(Genus, Species) %>%
  summarise(MeanPrev = mean(Prevalence), .groups = "drop") %>%
  arrange(factor(Genus, levels = genus_order), desc(MeanPrev))

species_prevalence$Species <- factor(species_prevalence$Species,
                                     levels = species_order$Species)
species_prevalence$Genus <- factor(species_prevalence$Genus,
                                   levels = genus_order)



library(ggplot2)

species_prev_plot <- ggplot(species_prevalence, aes(x = Method, y = Species, fill = Prevalence)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "white", high = blue_from_cividis, limit = c(0,1)) +
  labs(
    title = "Species Detection Prevalence by Method",
    x = "Method",
    y = "Species",
    fill = "Prevalence"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.y = element_text(size = 9),
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", hjust = 0.5)
  )



genus_sizes <- df_presence_sp_long %>%
  group_by(Genus) %>%
  summarise(n_species = n_distinct(Species)) %>%
  arrange(desc(n_species))



ggsave(plot=species_prev_plot, height = 169,width=169, dpi=300, units = 'mm', filename = "C:/Users/Weinstein Lab/Desktop/URCO-Horse-Project/species_prev_plot.pdf", useDingbats=FALSE)


```


jacc distance (dont really care about)




```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.



